import{aB as V,af as Me,D as T,aj as Te,z as g,F as ke,c as h,o as u,f as a,ab as n,g as v,p as s,e as L,i as Ve,n as O,P,ap as Z,t as d,m as k,h as y,a7 as be,an as p}from"./index-DjID3rZ8.js";import{E as De,a as Ke}from"./el-table-column-D_xBEzfu.js";import"./el-checkbox-Csi1Ga3g.js";import"./el-tooltip-l0sNRNKZ.js";import{a as $e}from"./el-tag-CpMCi0zU.js";import{E as Ye}from"./el-scrollbar-C8yJ5OvV.js";import{E as Ue}from"./el-dialog-lJuBrzUM.js";/* empty css                       *//* empty css                  *//* empty css                 */import{E as Ie}from"./el-input-number-C_csouuR.js";import{E as Se}from"./el-date-picker-CKuFfSSH.js";import{E as xe,a as Be}from"./el-select-XYZXFUzT.js";import{E as He}from"./el-empty-B5phVNrW.js";import{b as Le,E as Ne,a as Re}from"./el-dropdown-item-DXsS3qoj.js";import{I as w}from"./iconify-DCDCvEp6.js";import{l as q}from"./index-DCU6l3Wn.js";import{u as ze,r as G}from"./role-BcO03M9P.js";import{g as J}from"./text-C9KP7X7d.js";import{d as Q}from"./dayjs.min-A2jYZFuz.js";import{t as X}from"./day-CwdzhxWY.js";import{c as Ae}from"./clipboard-utils-CzPXxZBC.js";import{_ as Fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as je}from"./vnode-Dwxutr8L.js";import{E as We}from"./index-C59Ewne3.js";import{E as ee}from"./index-BflfZoXN.js";import"./index-BruQ8TLI.js";import"./index-CzYiMwKJ.js";import"./event-BB_Ol6Sd.js";import"./index-BLFajER1.js";import"./index-5BokGAPm.js";function Oe(f){return V.get("/regKey/list",{params:{...f}})}function Pe(f){return V.post("/regKey/add",f)}function Ze(f){return V.delete("/regKey/delete?regKeyIds="+f)}function qe(){return V.delete("/regKey/clearNotUse")}function Ge(f){return V.get("/regKey/history",{params:{regKeyId:f}})}const Je={class:"reg-key"},Qe={class:"header-actions"},Xe={class:"search"},et={class:"code-box"},tt={class:"code-item"},ot={class:"code-info"},nt={class:"info-left"},lt={class:"info-left-item"},rt=["onClick"],at={class:"info-left-item"},st={key:0},it={class:"info-left-item"},ct={class:"info-left-item"},dt={key:0},ut={class:"info-right"},mt={key:0,class:"empty"},pt={class:"container"},ft=Object.assign({name:"reg-key"},{__name:"index",setup(f){const te=ze(),N=Me(),b=T({code:""}),{t:c}=Te(),C=T([]),U=g(!1),D=g(!1),I=g(!0),S=g(!0),x=g(!1),B=T([]),E=g(0),R=g(0),K=g(!1),oe=window.innerWidth<1025,i=T({code:"",count:1,roleId:null,expireTime:null}),Y=T([]);_(!0),G().then(t=>{C.length=0,C.push(...t)}),ke(()=>te.refresh,()=>{G().then(t=>{C.length=0,C.push(...t)})});function ne(t){B.length=0,K.value=!0,Ge(t.regKeyId).then(e=>{if(B.push(...e),e.length>0){const l=e.reduce((m,M)=>z(m,M,"email")).email;E.value=J(l)+30,E.value=E.value<300?E.value:300;const r=e.reduce((m,M)=>z(m,M,"createTime")).createTime;R.value=J(r)}}).finally(()=>{K.value=!1}),x.value=!0}const z=(t,e,l)=>{const r=m=>(m.match(/[A-Z]/g)||[]).length;return t[l].length===e[l].length?r(t[l])>r(e[l])?t:e:t[l].length>e[l].length?t:e};function le(t){const e=X(t.createTime),l=Q().year(),r=e.year();return N.lang==="en"?r===l?e.format("MMM D, HH:mm"):e.format("MMM D, YYYY HH:mm"):r===l?e.format("M月D日 HH:mm"):e.format("YYYY年M月D日 HH:mm")}function re(t){const e=X(t),l=Q().year(),r=e.year();return N.lang==="en"?r===l?e.format("MMM D"):e.format("MMM D, YYYY"):r===l?e.format("M月D日"):e.format("YYYY年M月D日")}function ae(){b.code=null,_(!0)}function se(){_(!0)}function _(t=!1){t&&(I.value=!0),Oe(b).then(e=>{Y.length=0,Y.push(...e),I.value=!1,setTimeout(()=>{S.value=!1},200)})}async function A(t){try{await Ae(t),p({message:c("copySuccessMsg"),type:"success",plain:!0})}catch(e){console.error("复制失败:",e),p({message:"复制失败",type:"error",plain:!0})}}function F(){i.code=ie()}function ie(t=8){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let l="";for(let r=0;r<t;r++)l+=e.charAt(Math.floor(Math.random()*e.length));return l}function ce(){ee.confirm(c("clearRegKey"),{confirmButtonText:c("confirm"),cancelButtonText:c("cancel"),type:"warning"}).then(()=>{qe().then(()=>{p({message:c("clearSuccess"),type:"success",plain:!0}),_()})})}function de(){if(!i.code){p({message:$("emptyRegKeyMsg"),type:"error",plain:!0});return}if(!i.roleId){p({message:c("emptyRole"),type:"error",plain:!0});return}if(!i.expireTime){p({message:c("emptyTimeMsg"),type:"error",plain:!0});return}if(!i.count){p({message:c("emptyCountMsg"),type:"error",plain:!0});return}U.value=!0,Pe(i).then(()=>{D.value=!1,me(),p({message:c("addSuccessMsg"),type:"success",plain:!0}),_()}).finally(()=>{U.value=!1})}function ue(t){ee.confirm(c("delConfirm",{msg:t.code}),{confirmButtonText:c("confirm"),cancelButtonText:c("cancel"),type:"warning"}).then(()=>{Ze([t.regKeyId]).then(()=>{_(),p({message:c("delSuccessMsg"),type:"success",plain:!0})})})}function me(){i.code=""}function pe(){F(),D.value=!0}return(t,e)=>{const l=je,r=$e,m=Re,M=Ne,fe=Le,ge=He,he=Ye,ye=Be,_e=xe,ve=Se,we=Ie,Ce=We,j=Ue,W=Ke,Ee=De;return u(),h("div",Je,[a("div",Qe,[n(v(w),{class:"icon",icon:"ion:add-outline",width:"23",height:"23",onClick:pe}),a("div",Xe,[n(l,{modelValue:b.code,"onUpdate:modelValue":e[0]||(e[0]=o=>b.code=o),class:"search-input",placeholder:t.$t("searchRegKeyDesc")},null,8,["modelValue","placeholder"])]),n(v(w),{class:"icon",icon:"iconoir:search",onClick:se,width:"20",height:"20"}),n(v(w),{class:"icon",icon:"ion:reload",width:"18",height:"18",onClick:ae}),n(v(w),{class:"icon",icon:"fluent:broom-sparkle-16-regular",width:"22",height:"22",onClick:ce})]),n(he,{class:"scrollbar"},{default:s(()=>[a("div",{class:O(["loading",I.value?"loading-show":"loading-hide"]),style:Ve(S.value?"background: transparent":"")},[n(q)],6),a("div",et,[(u(!0),h(P,null,Z(Y,o=>(u(),h("div",tt,[a("div",ot,[a("div",nt,[a("div",lt,[a("span",{class:"code",onClick:H=>A(o.code)},d(o.code),9,rt)]),a("div",at,[a("div",null,d(t.$t("remainingUses"))+"：",1),o.count?(u(),h("div",st,d(o.count),1)):(u(),k(r,{key:1,type:"danger"},{default:s(()=>[y(d(t.$t("exhausted")),1)]),_:1}))]),a("div",it,[a("div",null,d(t.$t("roleDesc"))+"：",1),n(r,null,{default:s(()=>[y(d(o.roleName),1)]),_:2},1024)]),a("div",ct,[a("div",null,d(t.$t("validUntil"))+"：",1),o.expireTime?(u(),h("div",dt,d(re(o.expireTime)),1)):(u(),k(r,{key:1,type:"danger"},{default:s(()=>[y(d(t.$t("expired")),1)]),_:1}))])]),a("div",ut,[n(fe,{class:"setting"},{dropdown:s(()=>[n(M,null,{default:s(()=>[n(m,{onClick:H=>A(o.code)},{default:s(()=>[y(d(t.$t("copy")),1)]),_:2},1032,["onClick"]),n(m,{onClick:H=>ne(o)},{default:s(()=>[y(d(t.$t("history")),1)]),_:2},1032,["onClick"]),n(m,{onClick:H=>ue(o)},{default:s(()=>[y(d(t.$t("delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:s(()=>[n(v(w),{icon:"fluent:settings-24-filled",width:"21",height:"21",color:"#909399"})]),_:2},1024)])])]))),256))]),Y.length===0?(u(),h("div",mt,[S.value?L("",!0):(u(),k(ge,{key:0,"image-size":oe?120:0,description:t.$t("noCodeFound")},null,8,["image-size","description"]))])):L("",!0)]),_:1}),n(j,{modelValue:D.value,"onUpdate:modelValue":e[5]||(e[5]=o=>D.value=o),title:t.$t("addRegKey")},{default:s(()=>[a("div",pt,[n(l,{modelValue:i.code,"onUpdate:modelValue":e[1]||(e[1]=o=>i.code=o),placeholder:t.$t("regKey")},{suffix:s(()=>[n(v(w),{onClick:be(F,["stop"]),class:"gen-code",icon:"bitcoin-icons:refresh-filled",width:"24",height:"24"})]),_:1},8,["modelValue","placeholder"]),n(_e,{modelValue:i.roleId,"onUpdate:modelValue":e[2]||(e[2]=o=>i.roleId=o),placeholder:t.$t("roleDesc")},{default:s(()=>[(u(!0),h(P,null,Z(C,o=>(u(),k(ye,{label:o.name,value:o.roleId,key:o.roleId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),n(ve,{modelValue:i.expireTime,"onUpdate:modelValue":e[3]||(e[3]=o=>i.expireTime=o),type:"date",placeholder:t.$t("validUntil")},null,8,["modelValue","placeholder"]),n(we,{modelValue:i.count,"onUpdate:modelValue":e[4]||(e[4]=o=>i.count=o),min:1,max:99999},null,8,["modelValue"]),n(Ce,{class:"btn",type:"primary",onClick:de,loading:U.value},{default:s(()=>[y(d(t.$t("add")),1)]),_:1},8,["loading"])])]),_:1},8,["modelValue","title"]),n(j,{class:"history-list",modelValue:x.value,"onUpdate:modelValue":e[6]||(e[6]=o=>x.value=o),title:t.$t("useHistory")},{default:s(()=>[a("div",{class:O(["loading",K.value?"loading-show":"loading-hide"])},[n(q)],2),K.value?L("",!0):(u(),k(Ee,{key:0,data:B,fit:!0,style:{height:"100%"}},{default:s(()=>[n(W,{"min-width":E.value,property:"email",label:t.$t("user"),"show-overflow-tooltip":!0},null,8,["min-width","label"]),n(W,{width:R.value,formatter:le,property:"createTime",label:t.$t("date"),fixed:"right","show-overflow-tooltip":!0},null,8,["width","label"])]),_:1},8,["data"]))]),_:1},8,["modelValue","title"])])}}}),Ot=Fe(ft,[["__scopeId","data-v-f0891234"]]);export{Ot as default};
